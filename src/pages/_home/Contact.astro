---
import { Icon } from 'astro-icon/components'
import { t, getLocale } from 'i18n:astro'
import Button from '@components/Button.astro'
import { CV_LINKS } from '@data/constants'

const { cta } = t('hero', {
  returnObjects: true
})
const contact = t('contact', {
  returnObjects: true
}) as any
const { title, subtitle, cv_button } = contact

const locale = getLocale()
const cvLink = CV_LINKS[locale] || CV_LINKS.en
---

<section class="contact">
  <h2 class="headline-1">{title}</h2>
  <h3 class="headline-2">{subtitle}</h3>
  <div class="buttons-container">
    <Button class="filled" href="mailto:josuevj.1e.49@gmail.com">{cta}</Button>
    <Button href="https://www.linkedin.com/in/josu%C3%A9-v%C3%A1zquez-jim%C3%A9nez-5528881a8/">
      <Icon name="linkedin" size={24} />
      <span>LinkedIn</span>
    </Button>
    <Button href={cvLink} target="_blank" rel="noopener noreferrer">
      <Icon name="document" size={24} />
      <span>{cv_button}</span>
    </Button>
  </div>
  <canvas id="grid"></canvas>
</section>

<style>
  .contact {
    padding-block: 97px;
    padding-inline: 1rem;
    text-align: center;
    border: 1px solid rgba(128, 128, 128, 0.33);
    border-radius: 4px;
    position: relative;
    overflow: hidden;

    @media (width >= 768px) {
      padding-inline: 0;
    }

    & h3 {
      font-weight: initial;
    }

    & .buttons-container {
      display: flex;
      justify-content: center;
      flex-direction: column;
      gap: 13px;
      margin-top: 24px;

      @media (width >= 768px) {
        flex-direction: row;
      }
    }

    & canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }
  }
</style>

<script>
  import { GridField } from '@scripts/gridfield'

  const canvas = document.querySelector('#grid') as HTMLCanvasElement

  if (canvas) {
    const gridField = new GridField(canvas)

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Inicia la animación cuando el canvas entra en la vista
            gridField.play()
            // Deja de observar el canvas
            observer.unobserve(canvas)
          }
        })
      },
      {
        // Activar cuando al menos el 50% del canvas sea visible
        threshold: 0.5
      }
    )

    // Observa el canvas
    observer.observe(canvas)
  } else {
    // Mensaje de error si no se encuentra el canvas
    console.error("No se encontró el elemento 'canvas'")
  }
</script>
